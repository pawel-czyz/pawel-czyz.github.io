<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Czyż">
<meta name="dcterms.date" content="2025-02-22">
<meta name="description" content="One of the classical mathematical inequalities with applications to probability and information theory and its friends.">

<title>Paweł Czyż - Bernoulli’s inequality</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Paweł Czyż</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#probability-of-no-event-occurring" id="toc-probability-of-no-event-occurring" class="nav-link active" data-scroll-target="#probability-of-no-event-occurring">Probability of (no) event occurring</a>
  <ul class="collapse">
  <li><a href="#monte-carlo-estimators" id="toc-monte-carlo-estimators" class="nav-link" data-scroll-target="#monte-carlo-estimators">Monte Carlo estimators</a></li>
  <li><a href="#popovicius-inequality" id="toc-popovicius-inequality" class="nav-link" data-scroll-target="#popovicius-inequality">Popoviciu’s inequality</a></li>
  </ul></li>
  <li><a href="#generalized-inequality" id="toc-generalized-inequality" class="nav-link" data-scroll-target="#generalized-inequality">Generalized inequality</a>
  <ul class="collapse">
  <li><a href="#the-variance-of-the-pointwise-mutual-information-profile" id="toc-the-variance-of-the-pointwise-mutual-information-profile" class="nav-link" data-scroll-target="#the-variance-of-the-pointwise-mutual-information-profile">The variance of the pointwise mutual information profile</a></li>
  <li><a href="#events-not-occurring-again" id="toc-events-not-occurring-again" class="nav-link" data-scroll-target="#events-not-occurring-again">Events (not) occurring (again)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bernoulli’s inequality</h1>
</div>

<div>
  <div class="description">
    One of the classical mathematical inequalities with applications to probability and information theory and its friends.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Paweł Czyż </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Bernoulli trials appeared on the blog several times, for example <a href="../posts/beta-bernoulli.html">here</a> or <a href="../posts/almost-binomial-markov-chain.html">there</a>. Today we are going to do something slightly different.</p>
<p><a href="https://en.wikipedia.org/wiki/Bernoulli%27s_inequality">Bernoulli’s inequality</a> is one of the classic inequalities encountered during maths classes to teach mathematical induction. Namely, if <span class="math inline">\(n\ge 1\)</span> is an integer and <span class="math inline">\(x\ge -1\)</span>, then <span class="math display">\[
(1+x)^n \ge 1 + nx.
\]</span></p>
<p>The inequality is strict for <span class="math inline">\(n\ge 2\)</span> and <span class="math inline">\(x\neq 0\)</span>. The proof by induction is simple, where the inductive step is based on <span class="math display">\[\begin{align*}
  (1 + x)^{n+1}
  &amp;= (1+x) \cdot (1+x)^n \\
  &amp;\ge (1+x)(1+nx) \\
  &amp;= 1 + (n+1)x + nx^2.
\end{align*}
\]</span></p>
<p>In fact, this is not the strongest form of the inequality, with the <a href="https://en.wikipedia.org/wiki/Bernoulli%27s_inequality">Wikipedia article</a> listing many variants of it.</p>
<p>Today I wanted to discuss a few applications of this inequality.</p>
<section id="probability-of-no-event-occurring" class="level2">
<h2 class="anchored" data-anchor-id="probability-of-no-event-occurring">Probability of (no) event occurring</h2>
<p>Imagine that we observe a process which fails with probability <span class="math inline">\(p\)</span> many times, say <span class="math inline">\(n\)</span>. If the failures occur independently, what is the probability of having only successes? The probability of having only successes is <span class="math inline">\((1 - p)^n \ge 1 - pn\)</span>. The probability of observing at least one failure is then <span class="math inline">\(1 - (1-p)^n \le np\)</span>. We can therefore bound the probability of failures by controlling <span class="math inline">\(p\)</span>.</p>
<p>In fact, we can say more, as explained <a href="https://math.stackexchange.com/a/3025960/551592">here</a>. Because of the Bernoulli’s inequality, we have <span class="math display">\[
  (1 + x/n)^n \ge 1 + x,
\]</span> which gives (by passing to the limit <span class="math inline">\(n\to \infty\)</span>) the inequality <span class="math inline">\(e^x\ge 1 + x\)</span> (note that for <span class="math inline">\(x &lt; -1\)</span> it, in fact, also holds, as the right-hand-side is negative. To prove that the left-hand-side is positive, one can use <a href="https://en.wikipedia.org/wiki/Archimedean_property">Archimedean property</a> of real numbers to show that for all large enough <span class="math inline">\(n\)</span> we have <span class="math inline">\(x / n &gt; -1\)</span>).</p>
<p>Then, <span class="math display">\[
  e^{-pn} = ( e^{-p} )^n \ge (1 - p)^n \ge 1 - pn,
\]</span></p>
<p>which bounds <span class="math inline">\((1-p)^n\)</span> from both sides.</p>
<section id="monte-carlo-estimators" class="level3">
<h3 class="anchored" data-anchor-id="monte-carlo-estimators">Monte Carlo estimators</h3>
<p>This shows why Monte Carlo methods used to calculate volumes can fail in high dimensions. For example, the volume of a unit <span class="math inline">\(m\)</span>-ball, <span class="math inline">\(D_m = \{ ||x|| &lt; 1 \mid x \in [-1, 1]^m \}\)</span> is given by <span class="math display">\[
V_m = \begin{cases}
  2 &amp; \text{ if } m = 1\\
  \pi &amp;\text { if } m = 2\\
  \frac{2\pi}{m} V_{m-2} &amp;\text{ otherwise}
\end{cases}
\]</span></p>
<p>If we sample from the uniform distribution over the cube <span class="math inline">\([-1, 1]^m\)</span>, the probability of a sample landing inside the ball is <span class="math inline">\(p = V_m / 2^m\)</span>, which is tiny for large <span class="math inline">\(m\)</span>.</p>
<p>If we collect <span class="math inline">\(n\)</span> Monte Carlo samples, the probability that we see any sample inside the ball (and our estimate is not <span class="math inline">\(0\)</span>) is then smaller than <span class="math inline">\(pm\)</span>. In other words, in <span class="math inline">\(m=100\)</span> dimensions even if we collect million of samples, there is a very high probability that we return <span class="math inline">\(0\)</span> (so that the relative error of the Monte Carlo estimate is then 100%).</p>
</section>
<section id="popovicius-inequality" class="level3">
<h3 class="anchored" data-anchor-id="popovicius-inequality">Popoviciu’s inequality</h3>
<p>We see that with large probability our estimate for <span class="math inline">\(p\)</span> (and, in turn <span class="math inline">\(V_m\)</span>) is <span class="math inline">\(0\)</span>. The relative error is hence 100% with large probability. However, what can we say about the absolute error? In this case <span class="math inline">\(p\)</span> is very tiny, so that returning <span class="math inline">\(0\)</span> perhaps is not bad. The variance of the Monte Carlo estimator for <span class="math inline">\(n\)</span> samples is <span class="math inline">\(p(1-p) / n\)</span>. Note that <span class="math display">\[
  \sqrt{p(1-p)} \le \frac{p + (1-p)}{2} = 1/2,
\]</span></p>
<p>so that the variance of the Monte Carlo estimator is bounded from above by <span class="math inline">\(1/4n\)</span>. Of course, it can still be unacceptably large to obtain small relative errors, but this gives us some assurance about the absolute error.</p>
<p>More generally, <a href="https://en.wikipedia.org/wiki/Popoviciu%27s_inequality_on_variances">Popoviciu’s inequality</a> can be used here. It says that for a real-valued random variable bounded between <span class="math inline">\([L, U]\)</span>, its variance cannot exceed <span class="math inline">\((U-L)^2 / 4\)</span>.</p>
<p>As the variance does not change when the variable is shifted, we can move the variable to <span class="math inline">\([0, U-L]\)</span>, and then rescale it by <span class="math inline">\(U - L\)</span> to the interval <span class="math inline">\([0, 1]\)</span> (which scales the variance quadratically). Hence, it suffices to prove that for a random variable defined on the interval <span class="math inline">\([0, 1]\)</span>, its variance cannot exceed <span class="math inline">\(1/4\)</span> (which is the value attained for the Bernoulli random variable, assigning all the probability mass equally to the boundary of the interval).</p>
<p>Using the proof of the <a href="https://en.wikipedia.org/wiki/Bhatia%E2%80%93Davis_inequality">Bhatia-Davis inequality</a>, we get</p>
<p><span class="math display">\[
  0\le \mathbb E[ X (1-X) ] = \mathbb E[X] - \mathbb E[X^2].
\]</span></p>
<p>We see that <span class="math inline">\(\mathbb E[X^2] \le \mathbb E[X]\)</span>. Let <span class="math inline">\(p = \mathbb E[X] \in [0, 1]\)</span>. Consequently, we have <span class="math display">\[
  \mathbb E[X^2] - \mathbb E[X]^2 \le p - p^2 = p(1-p) \le 1/4  
\]</span></p>
<p>as above.</p>
</section>
</section>
<section id="generalized-inequality" class="level2">
<h2 class="anchored" data-anchor-id="generalized-inequality">Generalized inequality</h2>
<p>Similarly by induction, it is <a href="https://en.wikipedia.org/wiki/Bernoulli%27s_inequality#Generalization_of_base">possible to prove</a> that for <span class="math inline">\(n\)</span> numbers <span class="math inline">\(x_1, \dotsc, x_n\)</span> such that:</p>
<ul>
<li>all <span class="math inline">\(x_i &gt; -1\)</span>,</li>
<li>all <span class="math inline">\(x_i\)</span> are of the same sign,</li>
</ul>
<p>we have</p>
<p><span class="math display">\[
(1+x_1)(1+x_2) \cdots (1+x_n) \ge 1 + x_1 + x_2 +\cdots + x_n.
\]</span></p>
<p>Of course, the original inequality is obtained from the case <span class="math inline">\(x_1 = x_2 = \cdots = x_n\)</span>.</p>
<p>I think this is an important inequality.</p>
<section id="the-variance-of-the-pointwise-mutual-information-profile" class="level3">
<h3 class="anchored" data-anchor-id="the-variance-of-the-pointwise-mutual-information-profile">The variance of the pointwise mutual information profile</h3>
<p>In our <a href="../publications/pmi-profiles.html">pointwise mutual information paper</a>, we wanted to prove the bounds on the variance of the pointwise mutual information profile for the multivariate normal distribution, under the constraint that the mutual information is fixed at some pre-specified value.</p>
<p>We had to prove an inequality: <span class="math display">\[
a_1 a_2\cdots a_n + (n-1) \ge a_1 + a_2 + \cdots + a_n
\]</span></p>
<p>for any numbers <span class="math inline">\(a_i \in (0, 1]\)</span>.</p>
<p>As I did not know the generalized form of Bernoulli’s inequality back then, the proof in the appendix was done by induction. However, this could have been done in (essentially) one line!</p>
<p>Write <span class="math inline">\(x_i = a_i - 1\)</span>, so that we have <span class="math inline">\(x_i \in (-1, 0]\)</span>. All the numbers are larger than <span class="math inline">\(-1\)</span> and of the same sign. The Bernoulli’s inequality gives then:</p>
<p><span class="math display">\[\begin{align*}
a_1 a_2\cdots a_n
&amp;= (1 + x_1)(1+x_2)\cdots (1+x_n) \\
&amp;\ge 1 + x_1 + x_2 + \cdots + x_n \\
&amp;=  1 + (a_1 - 1) + (a_2 - 1) + \cdots + (a_n - 1) \\
&amp;= a_1 + a_2 + \cdots + a_n - (n - 1).
\end{align*}
\]</span></p>
</section>
<section id="events-not-occurring-again" class="level3">
<h3 class="anchored" data-anchor-id="events-not-occurring-again">Events (not) occurring (again)</h3>
<p>Let <span class="math inline">\(y_i = \mathbb P(Y_i)\)</span> for some events <span class="math inline">\(Y_1, \dotsc, Y_n\)</span>. All the numbers are in the set <span class="math inline">\([0, 1]\)</span>, so that <span class="math inline">\(x_i := -y_i \in [-1, 0]\)</span>. The Bernoulli’s inequality says then that</p>
<p><span class="math display">\[
  \prod_{i=1}^n (1 - y_i) \ge 1 - \sum_{i} y_i,
\]</span></p>
<p>which is <span class="math display">\[
  \prod_{i=1}^n \mathbb P( Y_i' ) \ge 1 - \sum_{i=1}^n \mathbb P(Y_i).
\]</span></p>
<p>where <span class="math inline">\(Y'\)</span> is the complement of the event <span class="math inline">\(Y\)</span>. Swapping <span class="math inline">\(Y_i\)</span> with <span class="math inline">\(Y_i'\)</span> gives also <span class="math display">\[
  \prod_{i=1}^n \mathbb P( Y_i ) \ge 1 - \sum_{i=1}^n \mathbb P(Y_i').
\]</span></p>
<p>This inequality has an easy interpretation when all <span class="math inline">\(Y_i\)</span> are independent. But to see it, we have to discuss <a href="https://en.wikipedia.org/wiki/Boole%27s_inequality">Boole’s inequality</a>, which says that for all events <span class="math inline">\(Y_1, \dots, Y_n\)</span> we have</p>
<p><span class="math display">\[
\mathbb P\!\left(\bigcup_{i=1}^n Y_i\right) \le \sum_{i=1}^n \mathbb P(Y_i).
\]</span></p>
<p>(In fact, here we can event take countably many events, as measures are <span class="math inline">\(\sigma\)</span>-sub-additive. But let’s talk about the finite case here.)</p>
<p>If <span class="math inline">\(Y_i\)</span> are all independent, the inequality we have seen above reduces to <span class="math display">\[
  \prod_{i=1}^n \mathbb P(Y_i) = \mathbb P\!\left(\bigcap_{i=1}^n Y_i\right) = 1 - \mathbb P\!\left( \bigcup_{i=1}^n Y_i' \right) \ge 1 - \sum_{i=1}^n \mathbb P(Y_i').
\]</span></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
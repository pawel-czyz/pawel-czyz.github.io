<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.302">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paweł Czyż">
<meta name="dcterms.date" content="2024-02-10">
<meta name="description" content="From time to time I receive a question on setting up a new project repository. I’m not really qualified to answer this question, but I’ll do my best.">

<title>Paweł Czyż - Setting up a new project repository</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Paweł Czyż</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#on-collaboration-and-mentorship" id="toc-on-collaboration-and-mentorship" class="nav-link active" data-scroll-target="#on-collaboration-and-mentorship">On collaboration and mentorship</a>
  <ul class="collapse">
  <li><a href="#student-mentorship" id="toc-student-mentorship" class="nav-link" data-scroll-target="#student-mentorship">Student mentorship</a></li>
  </ul></li>
  <li><a href="#setting-up-a-repository" id="toc-setting-up-a-repository" class="nav-link" data-scroll-target="#setting-up-a-repository">Setting up a repository</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Setting up a new project repository</h1>
</div>

<div>
  <div class="description">
    From time to time I receive a question on setting up a new project repository. I’m not really qualified to answer this question, but I’ll do my best.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Paweł Czyż </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 10, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>First, a disclaimer: I am not an expert and what I write below is likely to be suboptimal in many ways. On the other hand, in academia we rarely have access to an experienced team of software engineers, DevOps, testers and documentation writers, so perhaps some of the tricks below will be useful.</p>
<p>Secondly, setting up a new scientific project is generally much more complex than setting up a repository: discussing the project idea with the academic adviser, writing a good research plan, checking with an ethics committee, applying for a grant…</p>
<p>We will not cover any of these here, assuming that you have completed the necessary steps and you and your collaborators just want to start coding.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As mentioned, the advice below is likely to be suboptimal or incomplete – use it at your own risk.</p>
<p>However, any suggestions for improvements will be very welcome.</p>
</div>
</div>
<section id="on-collaboration-and-mentorship" class="level2">
<h2 class="anchored" data-anchor-id="on-collaboration-and-mentorship">On collaboration and mentorship</h2>
<p>Sometimes you will be the sole developer of the project. More frequently, you will be a member of a team. This includes mentoring students, which includes taking more responsibility, but we will discuss some of these aspects <a href="#mentorship">below</a>.</p>
<p>I think it is important to set the expectations on all sides involved. In the meeting it’s worth to discuss the following:</p>
<ul>
<li>Finding the time for a regular meeting. (Or, if a regular time slot is impossible, scheduling the next meeting.)</li>
<li>Does the whole team adhere to some best coding practices?</li>
<li>What are the views on authorship of the subsequent publication(s)?
<ul>
<li>How is it going to be reflected in the expected contributions and time committed to the project?</li>
<li>I don’t like politics, but this topic will eventually appear, so it’s good to discuss it early.</li>
</ul></li>
</ul>
<p>Regarding deciding on coding practices, we often use the following:</p>
<ul>
<li>We work within <a href="https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow">Git feature branch workflow</a>.</li>
<li>We try to submit small pull requests and have pull request reviewed happening as soon as possible.</li>
<li>We put ideas for next changes as GitHub issues.</li>
<li>When we want to discuss large code changes, sometimes we submit a PR just with function stubs and docstrings. This PR is not really going to be merged, but we can discuss proposed changes using reviewing capabilities, before the time is spent on implementing them.</li>
<li>We often do <a href="https://en.wikipedia.org/wiki/Pair_programming">pair programming</a>, which is great.</li>
<li>We have continuous integration set using GitHub Actions, which forces us to use consistent style (sometimes to write enough tests and documentation).</li>
</ul>
<section id="student-mentorship" class="level3">
<h3 class="anchored" data-anchor-id="student-mentorship">Student mentorship</h3>
<p>Speaking of mentoring students, I have <a href="../posts/expectations-student-mentorship.html">a separate document</a> on this topic. I think it is good to discuss expectations as early as possible and remember that part of our job is mentoring. Of course, it’s great that the students can contribute to the project, but in the end, they should learn useful skills via mentorship.</p>
<p>Speaking of coding aspects of mentorship:</p>
<ul>
<li>Schedule enough time in the calendar to the student at least once a week.</li>
<li>Discuss not only the science, but also other issues they may be facing. Isn’t the workload too high?</li>
<li>Do detailed code reviews (and pair programming, if possible), so they can learn software development from you.</li>
<li>For complicated changes, sometimes it may help to write code stubs. I.e., design interfaces, write most important function names (together with type annotations and docstrings) and ask the student to study them and fill in the missing bits.
<ul>
<li>Designing right abstractions is hard and it may take a lot of yor time.</li>
<li>But remember that this skill is hard even for experienced software developers, and many students haven’t had yet enough experience to handle these problems.<br>
</li>
</ul></li>
<li>Try to find balance with being hand-on and hands-off.
<ul>
<li>I find it quite difficult and this balance is going to depend on the project difficulty and the student’s needs.</li>
<li>Generally, being hands-on is important, so that they feel supported. Mentorship is a key part of our job.</li>
<li>On the other hand, <a href="https://en.wikipedia.org/wiki/Micromanagement">micromanagement</a> is bad.</li>
<li>Even if somebody is not not micromanaging, sometimes being too available can harm the student.
<ul>
<li>They need to know how to use available resources and work independently. (Whether they stay in academia or move to industry.)</li>
<li>Discuss with the students that they are expected to check obvious resources (like Wikipedia, Google, ChatGPT, project documentation…) before reaching out.</li>
<li>In some teams there is something like a formal “15-minute rule” and “1-hour rule”, but I think it’s better to rely on discussing the expectations early.</li>
<li>In some cases, answering the questions with a delay of a few hours seemed to reinforce the students to search for the answers on their own. I’m not convinced about this method, though, and would prefer to rely on clear communication of expectations.</li>
</ul></li>
</ul></li>
</ul>
</section>
</section>
<section id="setting-up-a-repository" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-a-repository">Setting up a repository</h2>
<p>Great: the research plan tells the team what they need to do, expectations are clear, but we still haven’t set up the repository.</p>
<p>I recommend taking studying how <a href="https://github.com/patrick-kidger/equinox">Equinox</a> is set up, which is the model solution.</p>
<ul>
<li>See <a href="https://github.com/patrick-kidger/equinox/tree/main/.github/workflows">.github/workflows</a> to see how GitHub Actions are set.</li>
<li>Note that <a href="https://pre-commit.com/">pre-commit</a> is used and configured.</li>
<li>Project manager is used. Equinox uses <a href="https://github.com/pypa/hatch">Hatch</a>, I usually go for <a href="https://python-poetry.org/">Poetry</a>.</li>
</ul>
<p>My personal steps to creating a new repository are the following:</p>
<ul>
<li>Create a new <a href="https://mamba.readthedocs.io/">Micromamba</a> environment. (There are many other alternatives to virtual environments, though.)</li>
<li>Initialise the project. I use Poetry and the <code>src</code> layout, i.e., <code>poetry new --src project_name</code>.</li>
<li>Create a GitHub repository and commit the changes.</li>
<li>Set up tests using <a href="https://docs.pytest.org/">PyTest</a>.
<ul>
<li>You can create a simple function and one unit test.</li>
</ul></li>
<li>Set up <a href="https://pre-commit.com/">pre-commit</a> checks.
<ul>
<li>For linting and formatting, I use <a href="https://github.com/astral-sh/ruff">Ruff</a>. (Alternatives include <a href="https://black.readthedocs.io/en/stable/">Black</a>, <a href="https://flake8.pycqa.org/en/latest/">flake8</a> and <a href="https://pycqa.github.io/isort/">isort</a>.)</li>
<li>For type checking I usually go for <a href="https://github.com/microsoft/pyright">Pyright</a>. (Alternatives include <a href="https://mypy-lang.org/">MyPy</a> and <a href="https://github.com/google/pytype">PyType</a>.)</li>
</ul></li>
<li>Set up documentation using <a href="https://squidfunk.github.io/mkdocs-material/">Material for Mkdocs</a>.</li>
<li>Make sure that GitHub Actions are configured and properly run. (As a starting point, consult the configurations of Equinox or <a href="https://github.com/cbg-ethz/pmhn">pMHN</a>.)</li>
<li>Set up pull request merging criteria on GitHub (depending on what has been agreed with the team):
<ul>
<li>Nobody can commit to <code>main</code> branch without a pull request.</li>
<li>Pre-commit checks and unit tests run properly.</li>
<li>The code is reviewed and conversations are resolved.</li>
<li>The branch has all changes from <code>main</code> (disputable).</li>
<li>The pull request is squashed into one commit on <code>main</code>, rather than merged (disputable).</li>
</ul></li>
</ul>
<p>Regarding the data science workflow (which often includes developing some Python package, but also running experiments and generating the figures):</p>
<ul>
<li>We usually develop Python code in <code>src/</code> and use <code>test/</code> and <code>docs/</code> for unit tests for its documentation.</li>
<li>To run experiments, we use <a href="https://snakemake.readthedocs.io/">Snakemake workflows</a> in the <code>workflows/</code> directory.
<ul>
<li>Ensuring reproducibility is important.</li>
<li>Micromamba works very nicely with Snakemake.</li>
<li>Alternatives include <a href="https://www.nextflow.io/">NextFlow</a> (I personally liked Snakemake more, though).</li>
</ul></li>
<li><a href="https://kedro.org/">Kedro</a> sounds interesting. At the moment of writing this post I haven’t had much experience with it, but I’m planning to try it.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>